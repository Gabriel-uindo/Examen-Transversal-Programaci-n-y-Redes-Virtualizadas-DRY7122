from flask import Flask, request
import sqlite3, hashlib

app = Flask(__name__)

def create_db():
    conn = sqlite3.connect('users.db')
    c = conn.cursor()
    c.execute('''CREATE TABLE IF NOT EXISTS users (name TEXT, password TEXT)''')
    conn.commit()
    conn.close()

@app.route('/register', methods=['POST'])
def register():
    name = request.form['name']
    password = hashlib.sha256(request.form['password'].encode()).hexdigest()
    conn = sqlite3.connect('users.db')
    c = conn.cursor()
    c.execute("INSERT INTO users VALUES (?,?)", (name, password))
    conn.commit()
    conn.close()
    return "Usuario registrado"

@app.route('/login', methods=['POST'])
def login():
    name = request.form['name']
    password = hashlib.sha256(request.form['password'].encode()).hexdigest()
    conn = sqlite3.connect('users.db')
    c = conn.cursor()
    c.execute("SELECT * FROM users WHERE name=? AND password=?", (name, password))
    data = c.fetchone()
    conn.close()
    if data:
        return "Login exitoso"
    else:
        return "Login fallido"

if __name__ == '__main__':
    create_db()
    app.run(port=5800)
